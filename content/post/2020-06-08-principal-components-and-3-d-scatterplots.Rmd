---
title: Principal components and 3-D scatterplots with Plotly
author: Danny Morris
date: "`r Sys.Date()`"
output: 
  blogdown::html_page:
    toc: true
    highlight: pygments
slug: principal-components-and-3-d-scatterplots
categories:
  - R
  - Statistics
  - Visualization
tags:
  - R
  - Statistics
  - Visualization
editor_options: 
  chunk_output_type: console
---

```{r, include=F}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

## Overview

This short post describes one of my favorite tricks for exploring and visualizing multidimensional data. The trick is to simply run vanilla principal components analysis (PCA) on the data and visualize the first three components using an interactive 3-D scatterplot from Plotly. 

## R packages

```{r}
library(tidyverse)
library(plotly)
library(DT)
```

## Data

The data contains eight socio-economic statistics for each state in the U.S. The data were collected at various points in the mid to late 1900s.

Prior to running PCA, place the numeric variables on the same scale using any scaling technique. The typical z-scale transformation is shown here.

```{r}
z_scale <- function(x) {
  (x - mean(x)) / sd(x)
}

states_tbl <- state.x77 %>%
  as_tibble() %>%
  mutate_all(list(z_scale)) %>%
  mutate(State = rownames(state.x77)) %>%
  mutate(Region = state.region)
```

## Principal components analysis

Vanilla principal components analysis shows the first three components explain $\approx$ 80% of the variance in the original data.

```{r}
pca <- states_tbl %>%
  select(-State, -Region) %>%
  princomp()

((pca$sdev**2) / sum(pca$sdev**2)) %>%
  cumsum() %>%
  enframe(name = "Component", value = "Var_Explained") %>%
  ggplot(aes(x = Component, y = Var_Explained)) +
  geom_point() +
  geom_line(aes(group = 1)) +
  scale_y_continuous(breaks = seq(0, 1, .1)) +
  labs(title = "Cumulative variance explained by each component",
       subtitle = "3 components explained roughly 80%") +
  theme_bw()
```

## 3-D scatterplot with Plotly

```{r}
pca_scores <- pca$scores %>%
  as_tibble() %>%
  mutate(State = states_tbl$State) %>%
  mutate(Region = states_tbl$Region)

plotly::plot_ly(data = pca_scores,
                x = ~Comp.1,
                y = ~Comp.2,
                z = ~Comp.3,
                shape = ~Region,
                text = ~State) %>%
  layout(title = "First three principal components")
```

## Conclusion

This is a simple yet effective trick for exploratory analysis that is sure to impress your colleagues.

