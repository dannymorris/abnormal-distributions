---
title: Deploying a Shiny App with Shiny Server on an AWS EC2 Instance
author: Danny Morris
date: '2019-07-06'
output: 
  blogdown::html_page:
    toc: true
    highlight: pygments
slug: deploying-a-shiny-app-with-shiny-server-on-an-aws-ec2-instance
categories:
  - R
  - Shiny
  - AWS
tags:
  - R
  - Shiny
  - AWS
---

<style>
pre {
  background-color: #f9f9f9;
}
</style>

# Prerequisites

- [Git for Windows](https://gitforwindows.org/), which includes Git Bash for connecting to the EC2 Linux instance.

- AWS account ( [free tier](https://aws.amazon.com/free/) optional)

- [RStudio Server Amazon Machine Image](http://www.louisaslett.com/RStudio_AMI/) for the US East, Ohio region. This image includes R, RStudio Server, Shiny, and many other nice features for data science.

# Launching the EC2 Linux Instance

1. Launch an EC2 Instance by selecting the [RStudio Server Amazon Machine Image](http://www.louisaslett.com/RStudio_AMI/) for the appropriate region.

![](/img/rstudio-server-ami-region.PNG)

2. Select the appropriate instance type. For demonstration purposes, a t2.micro is chosen

3. Select "Review and Launch", then select "Launch"

4. Create a new key pair. Provide an appropriate key pair name, e.g. "rstudio-server-shiny", then download the key pair.

5. Select "Launch Instances"

![](/img/download-key-pair.PNG)

# Connect to the EC2 Linux Insance

1. Naviage to the EC2 Dashboard and confirm the instance is running.

![](/img/ec2-instance-running.PNG)

2. Select the instance then click "Connect"

3. Open Git Bash and SSH into the Linux instance

```
cd Downloads
chmod 400 rstudio-server-shiny.pem

ssh -i "rstudio-server-shiny.pem" ubuntu@ec2-18-224-95-116.us-east-2.compute.amazonaws.com
```

![](/img/ec2-instance-ssh-connect.PNG) 

# Explore R Interactively

Once connected the EC2 Linux instance, you can explore the R installation interactively within Git Bash.

```
# Launch R
R -

# R version
R.version

# Packages installed with the AMI
library(dplyr)
installed.packages() %>% row.names()

# Quit the R session
quit()
```

There are 139 packages installed with this AMI. Notable packages pre-installed include `tidyverse`, `shiny`, `rmarkdown`, `Rcpp`, `DBi`, and many more. 


# Explore Additional Installations

```
apt-cache showpkg shiny-server
apt-cache showpkg rstudio-server

which rstudio-server
which shiny-server

which python

pip list
```

# Launch RStudio in the Browser

1. Locate and click on the Security Group to which the instance belongs

![](/img/ec2-instance-security-group.PNG)

2. Configure the Security Group to allow inbound HTTP (port 80) traffic

![](/img/ec2-instance-security-group-inbound.PNG)

3. Copy and paste the instance's Public DNS into the browser to launch RStudio Server. According the AMI instructions, the username is "rstudio" and the passwrod is the Instance ID

![](/img/ec2-instance-id.PNG)

![](/img/ec2-rstudio-server-login.PNG)

# Create Simple Shiny App

1. Once connected to RStudio Server in the browser, open a new R script and save the following code in a file called `app.R`. Place this file in `ShinyApps/sample-apps/basic-app/`.

```{r, eval = F}
## app.R ##

server <- function(input, output) {
  output$distPlot <- renderPlot({
    hist(rnorm(input$obs), col = 'darkgray', border = 'white')
  })
}

ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      sliderInput("obs", "Number of observations:", 
                  min = 10, max = 500, value = 100)
    ),
    mainPanel(plotOutput("distPlot"))
  )
)

shinyApp(ui = ui, server = server)

```

![](/img/ec2-rstudio-server-shiny-app.PNG)

2. Click "Run App" to test the app locally (the EC2 Linux instance).

# Launch App

1. In the instance's Security Group, add a Custom TCP rule to open port 3838 so Shiny Server can be accessed.

![](/img/ec2-rstudio-server-shiny-app.PNG)

2. Launch a sample app.

```
sudo /opt/shiny-server/bin/deploy-example default
```

3. Copy our app folder to Shiny Server

```
sudo cp -r /home/rstudio/ShinyApps/sample-apps/basic-app/ /srv/shiny-server/sample-apps/
```

4. Open the app at http://ec2-18-224-95-116.us-east-2.compute.amazonaws.com:3838/sample-apps/basic-app/