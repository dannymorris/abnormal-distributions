---
title: Row-wise Max Values for a Sparse Matrix Using RcppArmadillo
author: Danny Morris
date: '2019-07-01'
output: 
  blogdown::html_page:
    toc: true
slug: row-wise-min-and-max-values-in-a-sparse-matrix
categories:
  - R
tags:
  - Rcpp
  - R
editor_options: 
  chunk_output_type: console
---


<div id="TOC">
<ul>
<li><a href="#using-inline-functions">Using Inline Functions</a></li>
<li><a href="#sourcing-a-.cpp-file">Sourcing a .cpp File</a></li>
</ul>
</div>

<p>This document demonstrates how to extract maximum values for each row in a sparse matrix using RcppArmadillo for speed and efficiency.</p>
<pre class="r"><code>library(Matrix)
library(Rcpp)
library(RcppArmadillo)
library(magrittr)</code></pre>
<p>A sample sparse matrix implemented in the Matrix pacakge.</p>
<pre class="r"><code>i &lt;- c(1,3:8) 
j &lt;- c(2,9,6:10)
x &lt;- 7 * (1:7)

sparse_matrix &lt;- sparseMatrix(i, j, x = x) 

sparse_matrix</code></pre>
<pre><code>## 8 x 10 sparse Matrix of class &quot;dgCMatrix&quot;
##                              
## [1,] . 7 . . .  .  .  .  .  .
## [2,] . . . . .  .  .  .  .  .
## [3,] . . . . .  .  .  . 14  .
## [4,] . . . . . 21  .  .  .  .
## [5,] . . . . .  . 28  .  .  .
## [6,] . . . . .  .  . 35  .  .
## [7,] . . . . .  .  .  . 42  .
## [8,] . . . . .  .  .  .  . 49</code></pre>
<div id="using-inline-functions" class="section level1">
<h1>Using Inline Functions</h1>
<pre class="r"><code>rowwise_max &lt;- Rcpp::cppFunction(
  &quot;arma::sp_mat sp_row_max(arma::sp_mat X) {
   return arma::max(X, 1);
  }&quot;, depends= &quot;RcppArmadillo&quot;
)

rowwise_max_idx &lt;- Rcpp::cppFunction(
  &quot;arma::urowvec sp_row_max_id(arma::sp_mat X) {
   return arma::index_max(X.t(), 0);
  }&quot;, depends= &quot;RcppArmadillo&quot;
)</code></pre>
<pre class="r"><code>rowwise_max(sparse_matrix) %&gt;% as.vector()

rowwise_max_idx(sparse_matrix) %&gt;% as.vector()</code></pre>
</div>
<div id="sourcing-a-.cpp-file" class="section level1">
<h1>Sourcing a .cpp File</h1>
<p><code>rowwise_max.cpp</code></p>
<pre class="cpp"><code># include &lt;RcppArmadillo.h&gt;
// [[Rcpp::depends(RcppArmadillo)]]

using namespace Rcpp;
using namespace arma;

// [[Rcpp::export]]
arma::urowvec rowwise_max2(arma::sp_mat X) {
  return arma::index_max(X, 1);
}

// [[Rcpp::export]]
arma::sp_mat rowwise_max_idx2(arma::sp_mat X) {
  return arma::max(X.t(), 0);
}</code></pre>
<pre class="r"><code>rowwise_max2(sparse_matrix) %&gt;% as.vector()
rowwise_max_idx2(sparse_matrix) %&gt;% as.vector()</code></pre>
</div>
