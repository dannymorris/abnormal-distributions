---
title: Deploying a Plumber API on AWS EC2 Instance
author: Danny Morris
date: '2019-07-06'
output: 
  blogdown::html_page:
    toc: true
    highlight: pygments
slug: deploying-a-plumber-api-on-aws-ec2-instance
categories:
  - R
  - API
  - AWS
tags:
  - R
  - AWS
  - API
editor_options: 
  chunk_output_type: console
---

<style>
pre {
  background-color: #f9f9f9;
}
</style>

1. Launch an EC2 instance using [this AMI](http://www.louisaslett.com/RStudio_AMI/)

2. Connect to RStudio Sever on AWS EC2 Instance. See [this post](/post/2019/07/06/deploying-a-shiny-app-with-shiny-server-on-an-aws-ec2-instance/)

3. In RStudio Server, create a folder called `plumber-apis` (or something similar)

4. Create two .R files `sample-plumber.R` and `launch-sample-plumber.R`

![](/img/sample-plumber-files.PNG)

#### `sample-plumber.R`

```{r, eval = F}
# plumber.R

#* Echo back the input
#* @param msg The message to echo
#* @get /echo
function(msg=""){
  list(msg = paste0("The message is: '", msg, "'"))
}

#* Plot a histogram
#* @png
#* @get /plot
function(){
  rand <- rnorm(100)
  hist(rand)
}

#* Return the sum of two numbers
#* @param a The first number to add
#* @param b The second number to add
#* @post /sum
function(a, b){
  as.numeric(a) + as.numeric(b)
}
```


#### `launch-sample-plumber.R`

5. SSH into the EC2 instance using Git Bash and install the `plumber` package. See [this post](/post/2019/07/06/deploying-a-shiny-app-with-shiny-server-on-an-aws-ec2-instance/)

```
# launch R session
R -

# install plumber
install.packages("plumber")
```

6. Exit R and `cd` into RStudio Server home

```
cd /home/rstudio/plumber-apps/

# In RStudio Server, run getwd() to find the home directory
```

7. Run the `launch-sample-plumber.R` script to expose the API

```
R CMD BATCH launch-sample-plumber.R
```

8. Invoke the API's POST method from anywhere

```{r}
# From a Rstudio desktop client...

library(httr)

request <- POST("http://ec2-18-224-95-116.us-east-2.compute.amazonaws.com:8000/sum?b=1&a=3")

content(request, "parsed")
```
