---
title: Detecting Image Differences Using Python and OpenCV
author: Danny Morris
date: '2019-07-07'
output: 
  blogdown::html_page:
    toc: true
    highlight: pygments
slug: detecting-image-differences-using-python-and-opencv
categories:
  - Python
  - Computer Vision
tags:
  - Python
  - Computer Vision
editor_options: 
  chunk_output_type: console
---

This post was inspired by [this post](https://www.pyimagesearch.com/2017/06/19/image-difference-with-opencv-and-python/) written by [Adrian Rosebrock](https://www.pyimagesearch.com/author/adrian/) of [PyImageSearch](https://www.pyimagesearch.com/about/).

This document shows how to detect differences between two images using Python and OpenCV.

```{python}
# import the necessary packages
from skimage.measure import compare_ssim
import argparse
import imutils
import cv2

import matplotlib.pyplot as plt
import matplotlib.image as mpimg
import numpy as np
```


```{python}
# load the two input images
image_orig = cv2.imread("credit-card-original.PNG")

image_mod = cv2.imread("credit-card-modified.PNG")
```

```{python}
resized_orig = cv2.resize(image_orig, (300, 200))    
resized_mod = cv2.resize(image_mod, (300, 200))
```

```{python}
plt.imshow(resized_orig)
```

```{python}
plt.imshow(resized_mod)
```

```{python}
# convert the images to grayscale
gray_orig = cv2.cvtColor(resized_orig, cv2.COLOR_BGR2GRAY)
gray_mod = cv2.cvtColor(resized_mod, cv2.COLOR_BGR2GRAY)
```

```{python}
# compute the Structural Similarity Index (SSIM) between the two
# images, ensuring that the difference image is returned
(score, diff) = compare_ssim(gray_orig, gray_mod, full=True)

diff = (diff * 255).astype("uint8")

print("Structural Similarity Index: {}".format(score))
```

```{python}
# threshold the difference image, followed by finding contours to
# obtain the regions of the two input images that differ
thresh = cv2.threshold(diff, 0, 25,
    cv2.THRESH_BINARY_INV | cv2.THRESH_OTSU)[1]

cnts = cv2.findContours(thresh.copy(), cv2.RETR_EXTERNAL,
    cv2.CHAIN_APPROX_SIMPLE)

cnts = imutils.grab_contours(cnts)
```

```{python, eval = F}
# loop over the contours
for c in cnts:
# compute the bounding box of the contour and then draw the
# bounding box on both input images to represent where the two
# images differ
    (x, y, w, h) = cv2.boundingRect(c)
    cv2.rectangle(resized_orig, (x, y), (x + w, y + h), (0, 0, 255), 2)
    cv2.rectangle(resized_mod, (x, y), (x + w, y + h), (0, 0, 255), 2)
 
# show the output images
plt.imshow("Original", resized_orig)
plt.imshow("Modified", resized_mod)
cv2.imshow("Diff", diff)
cv2.imshow("Thresh", thresh)
cv2.waitKey(0)
```

![](/img/credit-card-modified-cv2-bounding-box.PNG)

![](/img/credit-card-original-cv2-bounding-box.PNG)










