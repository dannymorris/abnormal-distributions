---
title: "Getting started with Python in R Markdown using the reticulate package"
author: "Danny Morris"
date: "2018-01-09"
categories: ['Python']
output: 
  blogdown::html_page:
    toc: true
    highlight: pygments
editor_options: 
  chunk_output_type: console
---

<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#about">About</a></li>
<li><a href="#install-and-load-reticulate">Install and load reticulate</a></li>
<li><a href="#using-conda-environments">Using conda environments</a></li>
<li><a href="#installing-python-libraries">Installing Python libraries</a></li>
<li><a href="#writing-python-code-in-r-markdown">Writing Python code in R Markdown</a></li>
</ul>
</div>

<div id="about" class="section level2">
<h2>About</h2>
<p>One of my current goals is to gain basic familiarity with Python as a data science language. I’ve spent some time recently working with Pandas, seaborn, and sci-kit learn. I’ve had a pleasant experience working in the Spyder IDE. Still, nothing beats R Markdown for creating highly polished, reproducible documents and analyses. Fortunately, the R Markdown engine now supports Python programming. In the same document, you can mix R and Python while sharing objects between the two (e.g. dataframes). The <code>reticulate</code> package is what makes this Python/R integration happen.</p>
<p><a href="https://rstudio.github.io/reticulate/" class="uri">https://rstudio.github.io/reticulate/</a></p>
<blockquote>
<p>Reticulate embeds a Python session within your R session, enabling seamless, high-performance interoperability. If you are an R developer that uses Python for some of your work or a member of data science team that uses both languages, reticulate can dramatically streamline your workflow!</p>
</blockquote>
<p>This article provides a simple introduction to getting started with Python in R Markdown. It covers the reticulate package, conda environments, Python library installation, and inserting Python code chunks.</p>
</div>
<div id="install-and-load-reticulate" class="section level2">
<h2>Install and load reticulate</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;reticulate&quot;</span>)</code></pre>
<p>or the development version…</p>
<pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;rstudio/reticulate&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reticulate)
<span class="kw">packageVersion</span>(<span class="st">&quot;reticulate&quot;</span>)</code></pre>
<pre><code>## [1] &#39;1.11.1.9000&#39;</code></pre>
</div>
<div id="using-conda-environments" class="section level2">
<h2>Using conda environments</h2>
<p>Prior to my recent experience with Python, I hadn’t encountered conda. Here is a brief description of conda from the <a href="https://conda.io/docs/index.html">conda website</a>…</p>
<blockquote>
<p>Conda is an open source package management system and environment management system that runs on Windows, macOS and Linux. Conda quickly installs, runs and updates packages and their dependencies. Conda easily creates, saves, loads and switches between environments on your local computer. It was created for Python programs, but it can package and distribute software for any language.</p>
</blockquote>
<p>Essentially, you can use conda to install Python libraries and other dependencies to a particular environment. Once you “activate” the conda environment, libraries and dependencies within the environment are ready to be used.</p>
<p>After you <a href="https://conda.io/docs/user-guide/install/index.html">install conda</a> and the reticulate R package, you can create a conda environment using the following code.</p>
<pre class="sourceCode r"><code class="sourceCode r">reticulate<span class="op">::</span><span class="kw">conda_create</span>(<span class="st">&quot;r-reticulate&quot;</span>)</code></pre>
<p>If you already have a conda environment you want to use, you can activate like this.</p>
<pre class="sourceCode r"><code class="sourceCode r">reticulate<span class="op">::</span><span class="kw">use_condaenv</span>(<span class="st">&quot;r-reticulate&quot;</span>, <span class="dt">required =</span> <span class="ot">TRUE</span>)</code></pre>
<p>For a little more information about conda environments, here is an excerpt from the conda website.</p>
<blockquote>
<p>A conda environment is a directory that contains a specific collection of conda packages that you have installed. For example, you may have one environment with NumPy 1.7 and its dependencies, and another environment with NumPy 1.6 for legacy testing. If you change one environment, your other environments are not affected. You can easily activate or deactivate environments, which is how you switch between them. You can also share your environment with someone by giving them a copy of your environment.yaml file</p>
</blockquote>
</div>
<div id="installing-python-libraries" class="section level2">
<h2>Installing Python libraries</h2>
<p>I was successfully able to install Python packages to my conda environment using the two different approaches:</p>
<ol style="list-style-type: decimal">
<li>running <code>reticulate::py_install("LIB_NAME")</code></li>
<li>running <code>pip install LIB_NAME</code> in Anaconda Prompt</li>
</ol>
<p>For R users, option 1 is a breeze. Note that the library is installed into conda environment which is activated (run <code>reticulate::py_config()</code> to see the current configuration). To get option 2 to work, I used the following 3 steps.</p>
<ol style="list-style-type: decimal">
<li>open Anaconda Prompt</li>
<li>run <code>conda activate r-reticulate</code></li>
<li>run <code>pip install dfply</code></li>
</ol>
<p>Using either approach, I’ve installed the <code>dfply</code> Python library and it now appears in <code>Lib/site-packages</code> in my r-reticulate conda environment. I did find option 2 to complete much quicker than option 1, though I can’t explain why.</p>
</div>
<div id="writing-python-code-in-r-markdown" class="section level2">
<h2>Writing Python code in R Markdown</h2>
<p>In R Markdown, using Python is as simple as creating a new code chunk and specifying the Python engine.</p>
<p><img src="/img/python-rmd-chunk.png" /></p>
<pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> pandas <span class="im">as</span> pd

sales <span class="op">=</span> {<span class="st">&#39;account&#39;</span>: [<span class="st">&#39;A1&#39;</span>, <span class="st">&#39;A2&#39;</span>],
         <span class="st">&#39;value&#39;</span>: [<span class="st">&#39;10&#39;</span>, <span class="st">&#39;15&#39;</span>]}
         
df <span class="op">=</span> pd.DataFrame(sales)

df.head()</code></pre>
<pre><code>##   account value
## 0      A1    10
## 1      A2    15</code></pre>
</div>
