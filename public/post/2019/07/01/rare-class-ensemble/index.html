<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>A strategy for rare class learning using data-centric ensembling | Abnormal Distributions</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">All Posts</a></li>
      
      <li><a href="/categories/">By Topic</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">A strategy for rare class learning using data-centric ensembling</span></h1>
<h2 class="author">Danny Morris</h2>
<h2 class="date">2019/07/01</h2>
</div>

<main>

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#a-little-bit-about-ensembling">A little bit about ensembling</a></li>
<li><a href="#defining-the-strategy">Defining the strategy</a></li>
<li><a href="#testing-the-strategy">Testing the strategy</a></li>
<li><a href="#packages">Packages</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#exaggerate-class-imbalance">Exaggerate class imbalance</a></li>
<li><a href="#ensemble-function">Ensemble function</a></li>
</ul>
</div>

<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This post demonstrates a strategy for predicting out-of-sample cases using a binary classification ensemble when the training data contains imbalanced classes. This strategy is described by <a href="http://charuaggarwal.net/">Charu Aggarwal</a> in section 7.2 of his book <a href="https://www.amazon.com/Outlier-Analysis-Charu-C-Aggarwal/dp/3319475770/ref=pd_cp_14_1?pd_rd_w=8M3qy&amp;pf_rd_p=ef4dc990-a9ca-4945-ae0b-f8d549198ed6&amp;pf_rd_r=3TGSZZ1H5HYKMT0G80Q8&amp;pd_rd_r=f1e3c156-9e78-11e9-801d-cdc96cae2e7b&amp;pd_rd_wg=DXbV0&amp;pd_rd_i=3319475770&amp;psc=1&amp;refRID=3TGSZZ1H5HYKMT0G80Q8">Outlier Analysis</a>.</p>
</div>
<div id="a-little-bit-about-ensembling" class="section level2">
<h2>A little bit about ensembling</h2>
<p>The basic idea behing ensembling is to make predictions on out-of-sample data by combining the predictions from many models. There are two general approaches to ensembling: model-centric and data-centric. Model-centric ensembling combines predictions from several distinct algorithms (e.g. random forest, logistic regression, etc.). Data-centric ensembling combines predictions from the same algorithm trained on several distinct subsets of the training data. Of course model-centric and data-centric ensembling can be combined through the use of several algorithms trained on several subsets of the training data. In general, ensembling is a robust modeling strategy that reduces prediction variance and improves accuracy. One drawback to ensembling is that training, testing, and deploying an ensemble of models can be complex and time consuming. Another drawback is reduced interpretability since each model in the ensemble may be interpreted differently.</p>
</div>
<div id="defining-the-strategy" class="section level2">
<h2>Defining the strategy</h2>
<p>The strategy shown in this post is an example of data-centric ensembling applied to binary classification where the classes are imbalanced. The goal is to make accurate out-of-sample predictions by combining predictions from several rounds of training (e.g. 25 rounds). Prior to training, a dedicated out-of-sample testing set is drawn from the available data. The remainder is used for training. In each round of training, a balanced training subsample (subset of the training data) is created by downsampling the negative class to match the size of entire positive class. Predictions are made on the dedicated out-of-sample testing set. Once the training rounds are complete, the predictions from each round are combined by averaging the predicted probabilities for each case in the dedicated out-of-sample testing set.</p>
<p>This strategy is very efficient due to the use of downsampling, leading to training data sets that are very manageable in size. As a result, this strategy can be repeated many times without being too computationally expensive.</p>
</div>
<div id="testing-the-strategy" class="section level2">
<h2>Testing the strategy</h2>
<p>It is useful to think about the training strategy as a single data point. One should not draw any grand conclusions about a single data point. Instead, multiple data points are sought to gain a more complete understanding of the data. Likewise, any training strategy should be repeated several times to gain a more complete picture of how the final implementation is expected to work. This is why techniques such as repeated K-fold cross validation exist (to <em>repeat</em> the basic K-fold CV strategy).</p>
<p>For this reason, we do not want to draw conclusions about a single model, nor should we draw conclusions from a single implementation of the ensemble strategy. Instead, the ensemble strategy in this post is repeated several times (N=100). The outcomes across all repitions are then visualized to better understand how this strategy would be expected to work in a live setting.</p>
</div>
<div id="packages" class="section level2">
<h2>Packages</h2>
<p>A selection of pacakges from the <a href="https://rviews.rstudio.com/2019/06/19/a-gentle-intro-to-tidymodels/">tidymodels</a> framework are used throughout. The tidymodels framework represents the next step in the evolution of the excellent <a href="http://topepo.github.io/caret/index.html">caret</a> package written by Max Kuhn.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse) </a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(rsample)   </a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(ranger) </a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(imbalance)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(yardstick)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">options</span>(<span class="dt">yardstick.event_first =</span> F)</a></code></pre></div>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">data_url &lt;-<span class="st"> &quot;https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data&quot;</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">sample_df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(data_url, <span class="dt">col_names =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Class =</span> X11) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Class =</span> <span class="kw">ifelse</span>(Class <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="st">&quot;benign&quot;</span>, <span class="st">&quot;malignant&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(X1<span class="op">:</span>X10), <span class="kw">list</span>(as.numeric)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="st">  </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>X1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="st">  </span><span class="kw">select</span>(Class, <span class="kw">everything</span>())</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">DT<span class="op">::</span><span class="kw">datatable</span>(sample_df)</a></code></pre></div>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683"],["benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","malignant","benign","malignant","malignant","benign","benign","malignant","benign","malignant","malignant","benign","benign","malignant","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","malignant","benign","malignant","malignant","malignant","malignant","malignant","malignant","benign","malignant","benign","benign","malignant","malignant","malignant","malignant","malignant","malignant","malignant","malignant","malignant","malignant","malignant","malignant","benign","malignant","malignant","benign","malignant","benign","malignant","malignant","benign","benign","malignant","benign","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","malignant","malignant","benign","malignant","malignant","malignant","malignant","malignant","benign","malignant","benign","malignant","malignant","malignant","benign","benign","benign","malignant","benign","benign","benign","benign","malignant","malignant","malignant","benign","malignant","benign","malignant","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","malignant","benign","benign","malignant","benign","malignant","malignant","benign","benign","malignant","benign","benign","malignant","malignant","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","benign","benign","malignant","malignant","malignant","benign","malignant","benign","malignant","benign","benign","benign","malignant","malignant","benign","malignant","malignant","malignant","benign","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","malignant","malignant","benign","benign","benign","malignant","malignant","benign","malignant","malignant","malignant","benign","benign","malignant","benign","benign","malignant","malignant","malignant","malignant","benign","malignant","malignant","benign","malignant","malignant","malignant","benign","malignant","benign","malignant","malignant","malignant","malignant","benign","benign","benign","benign","benign","benign","malignant","malignant","benign","benign","malignant","benign","malignant","malignant","malignant","benign","benign","benign","benign","malignant","malignant","malignant","malignant","malignant","benign","malignant","malignant","malignant","benign","malignant","benign","malignant","malignant","benign","benign","benign","benign","malignant","benign","benign","malignant","malignant","malignant","malignant","malignant","benign","malignant","malignant","benign","benign","malignant","malignant","benign","benign","malignant","malignant","benign","malignant","benign","malignant","malignant","benign","benign","malignant","benign","benign","benign","malignant","benign","benign","malignant","malignant","benign","benign","malignant","benign","malignant","benign","benign","malignant","benign","malignant","malignant","malignant","benign","benign","malignant","malignant","benign","malignant","benign","benign","malignant","malignant","benign","benign","benign","malignant","benign","benign","benign","malignant","malignant","benign","benign","benign","malignant","benign","benign","malignant","malignant","malignant","malignant","malignant","malignant","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","malignant","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","malignant","benign","malignant","benign","benign","benign","benign","malignant","benign","benign","benign","malignant","benign","malignant","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","malignant","benign","malignant","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","malignant","malignant","benign","benign","benign","malignant","malignant","malignant","benign","malignant","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","malignant","benign","benign","malignant","malignant","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","malignant","malignant","malignant","malignant","benign","benign","malignant","benign","benign","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","malignant","benign","malignant","benign","malignant","malignant","malignant","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","malignant","benign","benign","malignant","benign","malignant","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","malignant","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","malignant","benign","benign","benign","benign","benign","benign","benign","benign","benign","malignant","benign","benign","benign","benign","malignant","malignant","malignant"],[5,5,3,6,4,8,1,2,2,4,1,2,5,1,8,7,4,4,10,6,7,10,3,1,5,3,5,2,1,3,2,10,2,3,2,10,6,5,2,10,6,5,10,1,3,1,4,7,9,5,10,5,10,10,8,8,5,9,5,1,9,6,1,10,4,5,8,1,5,6,1,9,10,1,1,5,3,2,2,4,5,3,3,5,3,3,4,2,1,3,4,1,2,1,2,5,9,7,10,2,4,8,10,7,10,1,1,6,1,8,10,10,3,1,8,4,1,3,1,4,10,5,5,1,7,3,8,1,5,2,5,3,3,5,4,3,4,3,2,9,1,2,3,1,3,8,1,7,10,4,1,5,1,2,9,10,4,3,1,4,5,10,3,1,3,1,1,6,8,5,2,5,4,5,1,1,6,5,8,2,1,10,5,1,10,7,5,1,3,4,8,5,1,3,9,10,1,5,1,5,10,1,1,5,8,8,1,10,10,8,1,1,6,6,1,10,4,7,10,1,10,8,1,10,7,6,8,10,3,10,9,8,10,5,3,2,1,1,5,8,8,4,1,10,6,6,9,5,3,3,3,5,10,5,8,10,7,5,10,3,10,1,8,5,3,7,3,3,1,1,10,3,2,1,10,7,8,10,3,6,5,1,1,10,5,5,8,9,8,1,10,1,8,10,1,1,7,3,2,1,8,1,1,5,6,1,4,7,3,5,1,3,10,1,8,10,10,5,5,5,8,1,6,1,1,8,10,1,2,1,7,1,5,1,3,4,5,2,3,2,1,4,5,8,8,10,6,3,3,4,2,2,6,5,1,1,4,1,4,5,3,1,1,1,3,5,1,10,3,2,2,3,7,5,2,5,1,10,3,1,1,3,3,4,3,1,3,3,5,3,1,1,4,1,2,3,1,10,5,8,3,8,1,5,2,3,10,4,5,3,9,5,8,1,2,1,5,5,3,6,10,10,4,4,5,10,5,1,1,5,2,1,5,1,5,4,5,3,4,2,10,10,8,5,5,5,3,6,4,4,10,10,6,4,1,3,6,6,4,5,3,4,4,5,4,5,5,9,8,5,1,3,10,3,6,1,5,4,5,5,3,1,4,4,4,6,4,4,4,1,3,8,1,5,2,1,5,5,3,6,4,1,1,3,4,1,4,10,7,3,3,4,4,6,4,7,4,1,3,2,1,5,5,4,6,5,3,5,4,2,5,6,2,3,7,3,1,3,4,3,4,5,5,2,5,5,5,1,3,4,5,3,4,8,10,8,7,3,1,10,5,5,1,1,1,5,5,6,3,5,1,8,5,9,5,4,2,10,5,4,5,4,5,3,5,3,1,4,5,5,10,4,1,5,5,10,5,8,2,2,4,3,4,5,3,6,7,1,5,3,4,2,2,4,6,5,1,8,3,3,10,4,4,5,4,3,3,1,2,3,1,1,5,3,3,1,5,4,3,3,5,5,7,1,1,4,1,1,3,1,5,3,5,5,3,3,2,5,1,4,1,5,1,2,10,5,5,1,1,1,1,3,4,1,1,5,3,3,3,2,5,4,4],[1,4,1,8,1,10,1,1,1,2,1,1,3,1,7,4,1,1,7,1,3,5,1,1,2,2,1,1,1,1,1,7,1,1,1,10,2,4,5,4,10,6,10,1,7,1,1,8,5,3,3,5,5,6,10,2,2,5,3,1,10,3,1,4,1,3,3,1,1,10,3,4,6,1,1,3,1,1,2,1,2,1,5,10,3,6,1,1,1,1,1,1,1,1,1,1,6,5,3,3,1,2,10,3,10,6,1,5,3,6,3,10,3,1,3,5,1,2,1,2,10,3,4,1,5,1,3,1,1,1,10,1,1,1,1,1,1,1,1,5,1,1,4,1,1,8,1,2,10,1,1,5,2,1,9,7,1,1,1,1,6,8,1,1,1,1,1,10,6,8,1,10,1,3,1,1,1,8,7,1,5,5,8,2,10,5,1,1,1,1,4,1,1,1,7,8,1,1,1,10,10,1,1,1,10,10,1,10,10,7,1,1,10,1,1,6,1,5,5,1,5,9,1,10,4,8,4,4,3,8,8,10,4,1,1,1,1,1,1,10,4,1,2,4,3,10,10,6,1,1,1,7,5,10,8,4,9,1,10,3,8,1,4,1,3,2,1,1,1,1,5,1,1,4,4,4,10,10,1,1,6,1,1,4,5,3,2,1,4,1,10,1,3,8,1,1,8,1,1,1,6,1,1,5,8,1,4,6,1,4,1,2,1,1,10,4,4,1,2,4,6,1,5,1,1,5,3,1,1,1,6,1,2,1,4,2,1,1,4,7,1,1,3,10,10,3,10,10,2,4,1,1,10,8,1,1,3,1,1,1,1,1,1,1,1,3,1,6,2,1,1,3,6,3,1,1,1,8,1,1,2,1,1,1,2,2,10,1,3,1,2,1,2,1,3,1,1,10,1,5,3,7,1,2,3,2,10,3,1,1,10,3,7,1,1,3,1,1,2,9,8,10,1,1,1,4,2,1,1,1,1,1,1,1,7,1,1,1,5,3,2,6,8,1,1,1,1,1,1,1,9,6,6,1,1,1,1,1,1,1,1,1,1,2,8,1,3,10,7,1,1,1,10,6,3,1,8,1,10,1,1,1,2,1,1,1,1,1,1,1,3,10,1,1,1,1,1,1,1,6,10,1,1,1,7,1,1,4,5,1,1,1,1,1,1,4,2,1,1,1,1,1,1,1,1,1,1,3,1,1,1,10,1,1,8,1,1,2,4,1,3,2,1,1,1,1,1,1,1,1,7,1,1,4,10,10,6,1,1,9,1,1,1,1,1,1,7,10,1,1,1,10,1,8,1,10,5,3,1,8,1,1,1,1,2,1,1,1,4,3,5,1,1,10,1,4,10,10,3,1,1,1,1,1,1,3,1,1,1,1,6,1,1,1,2,1,1,7,1,1,10,2,1,1,1,1,1,1,1,1,2,1,10,1,1,2,1,1,1,1,1,4,8,1,1,1,1,1,1,1,2,1,7,10,10,2,1,3,1,1,1,1,1,1,10,10,1,1,1,1,1,1,1,1,1,10,1,1,1,1,10,8,8],[1,4,1,8,1,10,1,2,1,1,1,1,3,1,5,6,1,1,7,1,2,5,1,1,3,1,1,1,3,1,1,7,1,2,1,10,1,4,3,3,10,5,10,1,7,1,1,7,8,3,6,5,5,6,10,4,3,5,5,1,10,4,1,2,1,4,8,1,3,2,3,5,4,2,4,1,1,1,2,1,1,1,7,6,6,6,1,1,1,1,1,1,1,1,1,1,9,6,5,4,2,3,10,4,10,8,1,4,1,4,3,10,2,1,3,5,1,1,2,1,10,5,6,1,3,1,5,1,3,1,8,1,1,1,1,1,2,1,1,5,1,1,5,1,1,7,1,4,8,1,1,5,2,1,10,7,1,1,1,1,7,10,1,1,1,1,1,10,5,7,1,10,1,3,1,1,1,8,6,1,8,6,4,3,10,10,1,1,1,1,4,1,1,1,7,8,1,1,1,10,9,1,1,1,10,8,1,10,10,8,1,1,7,3,1,4,1,6,5,1,7,9,1,10,7,7,6,5,2,8,8,10,3,3,1,1,1,1,1,10,4,1,2,4,3,10,10,6,1,1,1,7,8,10,9,4,4,4,6,5,8,1,7,1,5,4,1,1,1,1,7,1,1,3,6,5,10,10,1,3,6,1,1,4,7,4,1,2,10,1,10,1,4,4,1,1,7,1,1,1,4,1,1,5,7,1,4,3,1,6,1,2,1,1,3,6,7,1,2,6,7,1,5,1,1,5,3,1,1,1,4,1,2,1,4,3,1,1,5,10,1,1,3,10,5,5,10,3,2,4,1,1,10,8,3,3,2,3,2,1,2,1,1,1,1,4,1,3,2,1,1,2,6,3,1,1,1,7,1,1,3,1,1,1,1,3,8,1,3,1,1,1,2,1,2,2,1,10,2,6,2,8,1,2,1,2,10,3,3,1,10,6,8,1,1,1,1,1,2,7,10,10,1,3,1,3,2,1,1,1,1,1,1,1,9,1,1,1,5,1,2,5,9,2,3,1,1,1,1,1,8,6,6,1,2,1,1,1,1,1,1,2,1,1,7,1,2,10,8,2,1,1,10,4,2,1,9,1,10,2,1,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,7,4,1,1,2,8,1,1,5,6,1,1,1,1,3,1,4,2,1,1,1,3,1,2,1,1,1,1,1,1,3,1,10,1,1,3,1,1,2,2,1,1,2,1,1,1,1,1,1,1,1,10,2,1,4,8,4,10,1,1,7,2,1,1,1,1,2,10,5,1,1,1,10,1,8,1,8,7,4,2,6,1,2,3,1,4,1,1,1,6,2,10,1,1,10,1,3,10,10,1,1,3,1,1,1,1,3,2,1,1,3,6,1,1,1,3,1,1,4,1,4,7,4,1,1,1,1,1,1,1,1,2,1,10,1,1,1,1,1,1,1,1,5,8,1,1,1,3,3,1,1,2,1,4,10,7,1,1,2,1,4,2,1,1,1,10,10,1,1,1,1,1,1,1,1,1,10,1,1,1,1,10,6,8],[1,5,1,1,3,8,1,1,1,1,1,1,3,1,10,4,1,1,6,1,10,3,1,1,4,1,1,1,1,1,1,3,2,1,1,8,1,9,3,1,2,6,4,1,4,1,3,2,1,4,2,8,6,3,1,1,1,2,5,1,1,1,1,1,1,1,3,1,1,8,2,10,1,1,1,2,1,1,1,2,1,1,8,1,4,6,1,2,1,2,1,1,1,1,2,1,2,10,1,4,1,1,10,4,8,10,1,4,2,3,10,3,1,1,1,10,1,1,2,1,2,1,7,1,7,1,4,1,1,1,10,1,1,1,1,1,1,1,1,4,1,1,2,1,3,4,1,1,6,1,1,6,1,1,3,4,1,1,2,1,8,10,1,2,1,1,1,10,4,7,1,3,1,3,1,1,1,8,4,1,6,10,10,1,8,10,1,1,1,1,5,4,1,1,5,4,1,1,1,9,3,1,1,1,10,8,1,10,10,7,1,1,7,1,2,3,3,3,6,1,4,5,1,3,4,5,3,5,1,2,5,8,2,3,3,1,1,1,2,8,1,1,1,10,5,2,1,2,1,1,1,1,10,6,4,10,10,1,3,2,2,1,1,1,2,1,1,1,1,1,3,1,2,10,1,10,10,10,1,1,8,1,1,6,8,3,1,6,5,1,7,1,9,4,1,1,6,1,1,1,10,1,1,2,8,1,4,2,1,10,1,1,1,1,2,4,2,1,2,6,3,1,8,1,1,5,1,1,1,1,8,1,2,1,10,5,3,1,3,10,1,1,1,7,3,4,10,10,1,2,1,1,10,10,1,1,1,1,1,2,1,1,1,1,4,1,1,6,2,1,1,2,3,2,1,1,2,4,1,1,1,1,1,1,1,1,7,1,1,1,3,1,1,1,2,1,1,6,1,2,6,5,1,2,1,3,7,1,1,1,10,1,2,1,1,1,3,1,3,5,1,1,1,3,1,10,4,3,1,6,1,1,1,1,8,3,1,3,8,1,1,8,6,1,1,3,1,3,1,1,7,2,5,1,1,1,3,1,1,1,1,1,1,1,10,1,4,10,5,1,3,1,10,10,1,1,4,1,10,10,1,1,1,1,1,1,1,2,1,1,1,10,1,1,1,1,1,1,1,10,7,1,1,2,3,1,1,4,10,1,2,1,1,2,1,3,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,10,1,1,7,1,1,2,1,1,1,2,3,1,1,1,1,1,1,1,10,1,1,1,10,4,5,1,1,3,1,1,1,1,1,1,6,5,1,6,1,10,1,9,1,5,6,5,1,3,1,1,1,1,1,1,1,1,8,8,3,2,1,10,1,10,10,10,1,1,1,1,1,1,1,3,3,1,2,1,5,1,1,1,1,1,1,4,1,1,8,3,1,3,3,1,1,1,1,1,1,3,10,1,2,3,1,1,1,1,1,1,7,1,1,1,1,1,3,1,2,1,1,8,8,2,1,1,1,1,1,1,1,1,10,10,1,1,1,1,1,1,1,1,3,5,1,1,1,1,3,4,5],[2,7,2,3,2,7,2,2,2,2,1,2,2,2,7,6,2,2,4,2,5,6,2,2,2,1,2,2,2,1,2,8,2,2,2,6,1,2,6,3,8,10,8,2,4,2,2,4,2,2,3,10,8,4,3,5,6,2,3,2,10,5,2,3,2,8,4,2,2,10,2,6,3,2,2,2,2,3,1,2,2,2,8,10,5,5,2,3,2,2,2,2,2,2,2,2,10,5,10,2,2,6,10,3,2,8,2,3,2,5,2,10,2,2,2,4,4,2,2,2,10,8,9,2,4,2,5,10,2,2,8,2,3,2,2,2,2,2,2,4,2,2,6,3,8,10,1,6,4,2,2,3,2,2,6,5,2,2,1,2,8,6,2,1,2,2,2,8,3,10,2,8,2,6,1,2,2,5,4,1,5,6,5,2,6,10,2,2,2,2,4,2,2,2,5,10,2,2,2,6,7,1,1,1,5,4,2,7,3,5,2,2,6,2,2,10,1,3,3,2,4,3,1,10,3,6,3,5,3,8,6,6,3,2,1,2,2,2,2,5,2,2,2,2,3,8,10,4,2,2,2,5,3,10,5,6,10,2,3,3,3,2,3,2,3,3,2,2,2,2,3,2,2,4,2,2,8,10,3,4,6,2,2,2,6,4,5,4,4,2,9,2,3,4,2,2,4,2,3,2,10,2,1,5,6,5,6,5,2,2,2,2,2,2,6,5,2,2,2,4,3,2,4,2,1,2,2,2,2,2,10,2,3,1,5,3,2,2,7,7,2,3,3,10,8,3,10,6,4,2,2,2,8,5,2,1,3,2,2,2,2,2,2,1,3,4,2,4,2,2,2,3,2,3,2,3,2,3,2,1,2,2,2,2,2,2,6,2,2,2,2,2,2,2,2,2,2,8,2,3,3,10,2,2,5,2,10,2,2,2,10,2,4,2,2,2,4,2,2,5,3,6,2,2,2,4,2,2,2,3,2,2,2,1,6,1,2,2,6,3,2,5,6,2,2,2,2,2,2,2,6,4,4,2,2,1,2,1,2,2,2,2,2,2,4,1,2,10,5,2,1,1,6,3,3,2,3,1,6,4,1,1,2,2,2,2,2,2,2,2,2,7,2,2,2,2,2,2,1,3,3,1,1,2,4,3,3,3,4,2,2,2,2,2,1,4,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,4,1,1,4,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,5,2,2,6,6,8,3,2,2,4,2,2,2,2,2,2,5,4,2,3,2,6,2,6,2,4,4,3,2,4,2,2,2,2,1,2,1,2,4,5,5,2,2,10,2,3,5,6,2,1,2,2,2,2,2,3,2,2,1,3,7,2,2,2,2,2,2,5,2,2,7,2,2,2,2,2,2,2,2,2,2,2,10,2,3,2,2,2,2,2,2,8,3,2,2,2,2,2,2,2,2,2,6,5,5,2,2,3,2,2,2,2,2,2,5,4,2,2,2,2,2,2,2,2,2,4,2,2,3,2,7,3,4],[1,10,2,4,1,10,10,1,1,1,1,1,3,3,9,1,1,1,10,1,10,7,1,1,7,1,1,1,1,1,1,5,1,1,1,1,1,10,7,3,10,1,1,1,9,1,1,8,3,4,5,8,8,5,6,1,10,2,3,2,8,2,1,2,1,10,9,1,1,2,1,10,4,2,1,1,3,1,1,1,1,2,9,4,8,10,1,1,1,1,1,1,1,1,1,1,6,10,5,5,1,3,1,3,10,10,1,9,2,9,10,8,3,5,2,10,3,2,1,2,10,10,7,1,10,1,10,1,1,1,10,1,1,2,1,1,1,1,1,5,5,1,8,2,1,10,1,10,5,3,1,10,1,1,10,10,1,1,3,2,10,1,1,1,1,1,1,10,10,10,1,1,1,10,1,1,1,10,10,1,8,10,8,1,8,10,1,1,1,1,7,1,1,1,10,10,1,1,1,10,5,1,1,1,10,8,1,10,10,5,1,1,4,1,1,10,5,8,10,1,10,5,1,10,7,8,1,10,1,10,2,9,10,2,1,1,5,1,2,10,9,1,1,10,10,10,8,10,1,1,1,8,10,10,10,10,3,1,10,10,4,1,10,1,10,4,1,1,1,1,7,1,1,10,10,10,10,10,1,5,10,1,1,10,10,5,1,10,4,1,10,1,10,10,1,1,3,5,1,1,1,1,1,10,8,1,5,10,1,10,1,1,10,1,4,10,8,1,1,10,10,1,10,1,1,10,10,1,1,1,10,1,1,1,1,8,1,1,3,10,1,1,3,10,4,7,10,10,3,3,1,1,10,10,1,1,1,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,10,1,1,2,1,10,1,1,1,1,1,1,1,1,9,1,1,4,1,1,1,1,2,1,1,4,1,10,3,10,1,2,1,3,10,1,1,1,10,1,2,1,1,1,1,1,1,8,10,1,1,1,1,10,4,3,2,1,1,1,1,1,10,1,1,1,10,1,6,10,3,1,1,1,5,1,1,1,4,10,10,1,1,1,1,1,1,1,1,1,1,1,10,1,1,5,10,1,3,1,10,3,4,1,10,1,10,5,1,1,1,1,1,1,1,1,1,1,1,5,4,1,1,1,1,1,1,10,10,1,1,1,10,1,1,5,10,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,10,1,1,5,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,10,1,3,10,5,10,10,1,1,2,1,1,1,1,1,1,10,10,1,1,1,10,1,3,1,1,10,10,1,10,1,1,1,1,1,1,1,1,1,10,8,1,1,10,1,10,2,10,1,1,1,1,1,1,1,2,1,1,1,4,6,5,1,1,1,1,1,3,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,4,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,5,8,1,1,1,1,1,1,1,1,1,10,10,1,1,1,1,1,1,1,1,1,5,1,1,2,1,3,4,5],[3,3,3,3,3,9,3,3,1,2,3,2,4,3,5,4,2,3,4,3,5,7,2,3,3,2,2,2,1,2,3,7,3,2,2,8,7,5,7,6,7,3,8,2,4,2,3,3,2,3,4,7,7,3,3,5,5,5,4,2,3,3,2,4,3,4,8,3,2,7,7,4,3,4,2,2,3,2,7,2,3,7,7,4,4,6,3,2,3,1,3,2,3,3,1,3,2,7,3,2,3,7,8,3,4,5,2,7,5,3,7,8,3,1,3,7,1,3,3,3,5,5,8,2,7,3,1,1,2,3,3,2,2,3,2,1,2,1,1,4,1,2,4,2,5,7,3,5,8,1,1,3,2,3,7,5,3,3,1,3,3,3,3,1,1,3,2,10,6,5,3,5,3,3,3,1,3,7,5,3,7,7,9,3,7,4,2,3,3,3,7,3,1,2,7,8,3,3,3,7,3,3,3,3,8,7,3,7,10,5,2,3,8,3,3,9,2,7,7,2,8,7,3,9,7,8,4,4,3,4,4,3,5,2,3,3,5,3,3,7,3,3,1,5,3,7,3,3,1,2,3,3,5,10,7,5,5,3,4,7,8,3,3,3,7,3,3,2,2,3,3,3,3,5,5,3,10,4,2,5,4,1,3,2,7,4,1,7,7,3,7,3,3,3,3,3,8,5,2,1,3,1,2,4,8,3,7,7,3,4,3,2,5,2,3,7,6,3,2,4,3,1,3,3,2,4,7,3,1,1,9,1,1,1,3,7,1,3,4,4,2,2,3,7,4,3,8,5,2,2,3,2,7,8,1,2,2,1,2,2,2,1,2,2,2,3,1,7,3,1,1,1,7,3,2,2,2,7,2,1,2,2,3,1,2,1,9,1,2,1,1,2,2,2,3,2,2,8,3,6,3,7,2,3,1,3,8,3,2,1,10,1,5,2,2,2,3,2,1,4,5,2,1,1,1,10,1,1,1,2,1,1,1,1,8,2,1,1,10,1,1,8,10,1,1,1,1,1,1,1,7,9,7,1,2,2,1,1,1,1,1,1,1,1,7,1,1,10,9,1,1,2,8,3,4,1,7,2,6,2,2,1,1,2,2,3,2,2,3,1,1,4,1,1,1,1,2,1,2,8,9,1,2,1,9,1,1,7,5,2,1,1,3,1,2,6,2,3,2,2,3,3,3,2,2,2,1,1,2,2,2,7,1,1,7,2,3,4,2,1,4,2,1,2,2,3,3,3,2,3,10,3,2,2,10,8,9,2,2,7,3,2,2,2,3,2,7,6,1,1,1,10,2,4,1,10,7,4,1,7,2,2,3,2,1,2,2,2,8,8,7,1,1,10,1,7,8,10,2,2,2,2,2,2,2,6,2,1,2,1,7,1,1,1,1,2,1,5,1,1,10,2,1,1,1,2,2,1,1,2,1,1,10,2,1,2,2,2,3,2,2,3,7,1,2,3,2,2,2,1,1,3,7,7,7,3,3,1,2,1,2,1,1,1,10,5,3,1,1,1,1,2,1,1,1,4,1,2,1,1,8,10,10],[1,2,1,7,1,7,1,1,1,1,1,1,4,1,5,3,1,1,1,1,4,10,1,1,6,1,1,1,1,1,1,4,1,1,1,9,1,6,5,5,3,1,10,1,8,1,1,8,1,4,10,3,1,6,9,4,1,1,10,1,3,9,1,3,1,9,9,2,1,8,2,8,2,2,1,1,1,1,1,1,1,1,10,10,4,8,1,1,1,1,1,1,1,1,1,1,9,9,10,5,1,1,8,2,1,7,3,8,3,1,3,1,1,1,2,5,1,1,1,1,3,3,10,1,5,1,6,1,1,1,6,2,1,3,1,1,1,1,1,3,1,1,1,1,8,8,1,4,10,1,1,1,1,1,10,7,2,1,1,2,10,1,1,1,1,1,1,10,1,7,1,10,1,1,1,1,1,8,1,1,10,7,10,1,10,10,1,1,1,1,8,1,1,1,8,1,1,1,1,10,5,1,1,1,10,7,1,10,6,10,1,1,10,1,1,10,1,4,9,1,9,7,1,10,6,9,3,1,6,8,10,10,3,3,1,1,1,1,1,8,3,6,1,3,5,3,3,6,1,1,1,4,1,6,8,5,3,2,3,1,7,1,9,1,1,3,2,1,1,1,3,1,1,6,3,8,7,10,1,10,10,1,1,3,4,7,1,7,10,1,10,1,3,10,1,1,8,1,1,1,5,1,1,3,9,1,3,4,1,1,1,3,4,1,10,1,1,1,2,3,4,1,4,1,1,3,6,1,1,1,5,1,3,3,3,6,1,1,6,9,1,2,3,3,10,5,10,1,1,1,1,1,10,10,1,1,1,1,1,1,1,1,1,1,2,1,1,8,2,1,1,2,1,1,2,2,1,9,1,1,1,1,1,1,2,1,3,1,1,1,2,1,1,1,1,1,1,5,1,6,5,2,1,2,1,1,2,3,1,1,10,1,10,1,1,2,2,2,1,2,1,8,1,1,1,1,1,1,1,1,1,1,1,1,10,1,1,1,7,1,1,6,10,1,1,1,1,1,2,1,10,7,6,1,1,1,1,1,1,1,1,1,1,1,5,1,1,10,10,1,1,1,1,4,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,8,1,1,1,1,1,1,1,10,10,1,1,1,1,1,1,3,3,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,10,1,1,8,1,1,2,1,1,8,1,1,1,1,1,1,1,1,2,10,1,1,5,3,2,10,1,1,7,1,1,1,1,1,1,5,10,1,1,1,10,2,1,1,1,6,1,1,1,1,1,1,1,1,1,1,1,10,1,8,1,1,1,1,1,5,10,1,1,1,1,1,1,1,1,1,1,1,1,7,1,1,1,1,1,1,10,1,1,10,1,1,1,1,1,1,1,1,1,1,1,10,1,1,1,2,1,1,1,1,6,2,1,1,1,1,1,1,1,1,1,10,10,4,1,1,1,1,1,1,1,1,1,10,6,2,1,1,1,1,3,1,1,1,4,1,1,1,1,10,6,4],[1,1,1,1,1,1,1,1,5,1,1,1,1,1,4,1,1,1,2,1,4,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,2,3,1,1,2,1,1,1,2,5,1,2,7,1,1,1,4,1,1,1,1,1,1,1,10,1,1,8,1,1,10,1,1,3,1,1,1,1,1,1,1,1,1,7,10,1,3,1,1,1,1,1,1,1,1,1,1,10,4,2,1,1,1,8,7,1,1,1,3,2,1,3,1,1,1,1,8,1,1,1,1,3,1,1,1,5,1,2,1,1,1,3,1,1,1,1,1,1,1,1,3,1,1,1,1,1,7,1,3,1,1,1,1,1,1,6,2,1,1,7,1,3,10,1,1,1,1,1,7,1,1,1,3,1,1,1,1,1,1,1,1,1,10,1,1,1,3,1,1,1,1,2,1,1,1,3,1,1,1,1,5,1,1,1,1,6,1,1,4,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,10,4,10,2,1,1,1,1,1,1,1,1,1,1,3,3,3,1,1,1,1,1,1,3,5,1,1,3,1,2,1,8,1,2,1,1,1,1,1,1,1,8,1,1,1,1,2,3,10,1,1,4,1,1,1,1,1,1,2,1,1,10,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,4,1,1,3,8,3,3,10,4,1,1,1,1,7,3,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,3,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,5,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,7,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,2,1,10,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,2,1,3,1,1,1,1,1,1,1,1,1,1,1,7,3,1,1,1,1,1,1,1,8,1,1,1,2,1,1,2,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Class<\/th>\n      <th>X2<\/th>\n      <th>X3<\/th>\n      <th>X4<\/th>\n      <th>X5<\/th>\n      <th>X6<\/th>\n      <th>X7<\/th>\n      <th>X8<\/th>\n      <th>X9<\/th>\n      <th>X10<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="exaggerate-class-imbalance" class="section level2">
<h2>Exaggerate class imbalance</h2>
<p>For demonstration purposes, the number of positive cases is reduced.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">negative_class &lt;-<span class="st"> </span>sample_df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw">filter</span>(Class <span class="op">==</span><span class="st"> &quot;benign&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">positive_class &lt;-<span class="st"> </span>sample_df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">  </span><span class="kw">filter</span>(Class <span class="op">==</span><span class="st"> &quot;malignant&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">  </span><span class="kw">sample_frac</span>(<span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">model_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(negative_class, positive_class)</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Class distribution</span></a>
<a class="sourceLine" id="cb4-2" title="2">model_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(Class)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Class         n
##   &lt;chr&gt;     &lt;int&gt;
## 1 benign      444
## 2 malignant    48</code></pre>
</div>
<div id="ensemble-function" class="section level2">
<h2>Ensemble function</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">ens_fun &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">train_split =</span> <span class="fl">0.7</span>, <span class="dt">subsamples =</span> <span class="dv">25</span>) {</a>
<a class="sourceLine" id="cb6-2" title="2">  </a>
<a class="sourceLine" id="cb6-3" title="3">  split_pct &lt;-<span class="st"> </span>train_split</a>
<a class="sourceLine" id="cb6-4" title="4">  </a>
<a class="sourceLine" id="cb6-5" title="5">  train_test_split &lt;-<span class="st"> </span>rsample<span class="op">::</span><span class="kw">initial_split</span>(</a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="dt">data =</span> model_df, </a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="dt">prop =</span> split_pct,</a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="dt">strata =</span> <span class="st">&quot;Class&quot;</span></a>
<a class="sourceLine" id="cb6-9" title="9">  )</a>
<a class="sourceLine" id="cb6-10" title="10">  </a>
<a class="sourceLine" id="cb6-11" title="11">  train &lt;-<span class="st"> </span>rsample<span class="op">::</span><span class="kw">training</span>(train_test_split)</a>
<a class="sourceLine" id="cb6-12" title="12">  </a>
<a class="sourceLine" id="cb6-13" title="13">  out_of_sample &lt;-<span class="st"> </span>rsample<span class="op">::</span><span class="kw">assessment</span>(train_test_split)</a>
<a class="sourceLine" id="cb6-14" title="14">  </a>
<a class="sourceLine" id="cb6-15" title="15">  n_positive &lt;-<span class="st"> </span>train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Class <span class="op">==</span><span class="st"> &quot;malignant&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="st">    </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb6-18" title="18">  </a>
<a class="sourceLine" id="cb6-19" title="19">  subsample_idx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, subsamples, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-20" title="20">  </a>
<a class="sourceLine" id="cb6-21" title="21">  subsamples &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(subsample_idx, <span class="cf">function</span>(idx) {</a>
<a class="sourceLine" id="cb6-22" title="22">    train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Class) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="st">      </span><span class="kw">sample_n</span>(<span class="dt">size =</span> n_positive) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="st">      </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb6-26" title="26">  }) </a>
<a class="sourceLine" id="cb6-27" title="27">  </a>
<a class="sourceLine" id="cb6-28" title="28">  models &lt;-<span class="st"> </span><span class="kw">map</span>(subsamples, <span class="cf">function</span>(idx) {</a>
<a class="sourceLine" id="cb6-29" title="29">    ranger_model &lt;-<span class="st"> </span>ranger<span class="op">::</span><span class="kw">ranger</span>(</a>
<a class="sourceLine" id="cb6-30" title="30">      <span class="dt">formula =</span> <span class="kw">as.factor</span>(Class) <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb6-31" title="31">      <span class="dt">data =</span> idx,</a>
<a class="sourceLine" id="cb6-32" title="32">      <span class="dt">probability =</span> T</a>
<a class="sourceLine" id="cb6-33" title="33">    )</a>
<a class="sourceLine" id="cb6-34" title="34">  })</a>
<a class="sourceLine" id="cb6-35" title="35">  </a>
<a class="sourceLine" id="cb6-36" title="36">  probs &lt;-<span class="st"> </span><span class="kw">map</span>(models, <span class="cf">function</span>(idx) {</a>
<a class="sourceLine" id="cb6-37" title="37">    <span class="kw">predict</span>(idx, <span class="dt">data =</span> out_of_sample)<span class="op">$</span>predictions[, <span class="st">&quot;malignant&quot;</span>]</a>
<a class="sourceLine" id="cb6-38" title="38">  }) </a>
<a class="sourceLine" id="cb6-39" title="39">  </a>
<a class="sourceLine" id="cb6-40" title="40">  avg_prob &lt;-<span class="st"> </span>probs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-41" title="41"><span class="st">    </span><span class="kw">bind_cols</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="st">    </span><span class="kw">apply</span>(., <span class="fl">1.</span>, mean)</a>
<a class="sourceLine" id="cb6-43" title="43">  </a>
<a class="sourceLine" id="cb6-44" title="44">  pred_label &lt;-<span class="st"> </span><span class="kw">ifelse</span>(avg_prob <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;malignant&quot;</span>, <span class="st">&quot;benign&quot;</span>)</a>
<a class="sourceLine" id="cb6-45" title="45">  </a>
<a class="sourceLine" id="cb6-46" title="46">  ensemble_f1 &lt;-<span class="st"> </span><span class="kw">f_meas_vec</span>(</a>
<a class="sourceLine" id="cb6-47" title="47">    <span class="kw">factor</span>(out_of_sample<span class="op">$</span>Class), </a>
<a class="sourceLine" id="cb6-48" title="48">    <span class="kw">factor</span>(pred_label)</a>
<a class="sourceLine" id="cb6-49" title="49">  )</a>
<a class="sourceLine" id="cb6-50" title="50">  </a>
<a class="sourceLine" id="cb6-51" title="51">  <span class="kw">return</span>(ensemble_f1)</a>
<a class="sourceLine" id="cb6-52" title="52">}</a>
<a class="sourceLine" id="cb6-53" title="53"></a>
<a class="sourceLine" id="cb6-54" title="54">exp_idx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-55" title="55"></a>
<a class="sourceLine" id="cb6-56" title="56">exp &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(exp_idx, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-57" title="57">  <span class="kw">ens_fun</span>(<span class="dt">subsamples =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb6-58" title="58">})</a>
<a class="sourceLine" id="cb6-59" title="59"></a>
<a class="sourceLine" id="cb6-60" title="60"><span class="kw">enframe</span>(exp, <span class="dt">name =</span> <span class="st">&quot;Experiment&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;Experiment_F1&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-61" title="61"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Experiment_F1)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-62" title="62"><span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-63" title="63"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw">pretty_breaks</span>(<span class="dt">n=</span><span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-64" title="64"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;F1 across 25 subsamples&quot;</span>,</a>
<a class="sourceLine" id="cb6-65" title="65">       <span class="dt">subtitle =</span> <span class="st">&quot;The ensemble reduces variation and improves accuracy.&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-66" title="66"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="/post/2019-07-01-rare-class-ensemble_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>

</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-143402170-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-143402170-1');
</script>


  
  <hr/>
  <a href="https://github.com/dannymorris">Github</a> | <a href="https://www.linkedin.com/in/drmorris87/">LinkedIn</a> | <a href="mailto:drmorris87@outlook.com">Email</a>
  
  </footer>
  </body>
</html>

